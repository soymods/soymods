<!doctype html>
<html lang="en">
<head>
  <!-- Open Graph -->
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="soymods">
  <meta property="og:title" content="Pathmind — soymods">
  <meta property="og:description" content="Pathmind — a modular, node-driven system for scripting in-game actions and crafting sequences.">
  <meta property="og:url" content="https://soymods.com/pathmind">
  <meta property="og:image" content="https://soymods.com/og.png">
  <meta property="og:image:width" content="1200">
  <meta property="og:image:height" content="630">

  <!-- Twitter / X -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Pathmind — soymods">
  <meta name="twitter:description" content="Pathmind — a modular, node-driven system for scripting in-game actions and crafting sequences.">
  <meta name="twitter:image" content="https://soymods.com/og.png">

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />

  <!-- Favicons -->
  <link rel="icon" href="/favicon.ico" sizes="any">
  <link rel="icon" type="image/png" href="/icon.png" sizes="32x32">
  <link rel="apple-touch-icon" href="/icon.png">

  <title>Pathmind — soymods</title>
  <meta name="description" content="Pathmind — a modular, node-driven system for scripting in-game actions and crafting sequences." />

  <style>
    :root{
      --bg:#0e0e0e;
      --fg:#ffffff;
      --muted:rgba(255,255,255,.68);
      --muted2:rgba(255,255,255,.46);

      --line:rgba(255,255,255,.16);
      --line2:rgba(255,255,255,.24);

      --r:0px;
      --bw:2px;

      --ease:cubic-bezier(.2,.8,.2,1);
      --max:1100px;
    }

    /* Fonts (self-host)
       Regular: Minecraft (https://www.dafont.com/minecraft.font)
       Titles/bold: Minecrafter (https://www.dafont.com/minecrafter.font)
       Place at:
         /fonts/Minecraft.woff2 (or .ttf)
         /fonts/Minecrafter.woff2 (or .ttf)
    */
    @font-face{
      font-family:"Minecraft";
      src:
        url("/fonts/Minecraft.woff2") format("woff2"),
        url("/fonts/Minecraft.ttf") format("truetype");
      font-display:swap;
    }
    @font-face{
      font-family:"Minecrafter";
      src:
        url("/fonts/Minecrafter.woff2") format("woff2"),
        url("/fonts/Minecrafter.ttf") format("truetype");
      font-display:swap;
    }

    *{box-sizing:border-box}
    html,body{height:100%; background:var(--bg);}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font-family:"Minecraft", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale;
      letter-spacing: 0.035em;
      overflow-x:hidden;
    }

    /* Titles + bold */
    h1,h2,h3,.btn,.badge,.panelVideoHead b,.row span:last-child,
    strong,b,.brand,.node .name{
      font-family:"Minecrafter","Minecraft",monospace;
      letter-spacing: 0.02em;
    }

    a{color:inherit;text-decoration:none}

    a:focus-visible,button:focus-visible{
      outline:var(--bw) solid #fff;
      outline-offset:3px;
      border-radius:0;
    }

    /* Background grid (bigger + calmer) */
    .bg{
      position:fixed;
      inset:0;
      pointer-events:none;
      opacity:.35;
      background:
        repeating-linear-gradient(
          to right,
          transparent 0,
          transparent 47px,
          rgba(255,255,255,.09) 48px
        ),
        repeating-linear-gradient(
          to bottom,
          transparent 0,
          transparent 47px,
          rgba(255,255,255,.09) 48px
        );
    }
    .dots{display:none !important;}

    header{
      position:sticky; top:0; z-index:10;
      background:rgba(0,0,0,.92);
      border-bottom:var(--bw) solid var(--line);
    }
    .wrap{max-width:var(--max); margin:0 auto; padding:18px 18px;}
    .nav{display:flex; align-items:flex-start; justify-content:space-between; gap:14px;}

    .brand{
      position:absolute;
      top:10px; left:10px;
      font-weight:900;
      font-size:14px;
      text-transform:uppercase;
    }

    main{padding: 22px 0 64px; background:transparent;}

    .hero{
      position:relative;
      min-height: calc(100vh - 78px);
      display:grid;
      place-items:center;
      padding: 26px 0 10px;
    }

    .heroInner{
      width:min(920px, 100%);
      padding: 0 18px;
      text-align:center;
    }

    /* NEW: logo replaces big word */
    .logo-img{
      width: clamp(160px, 28vw, 210px);
      height: auto;
      margin: 0 auto 10px;
      display:block;
      image-rendering: pixelated;
      image-rendering: crisp-edges;
      filter: drop-shadow(0 8px 0 #111) drop-shadow(0 16px 0 #070707);
      transform: translateY(10px);
      opacity:0;
      transition: transform .7s var(--ease), opacity .7s var(--ease);
    }
    .logo-img.reveal{transform: translateY(0); opacity:1}

    /* Pathmind text smaller under logo */
    .word{
      margin:0;
      font-size: clamp(20px, 3.2vw, 40px);
      line-height: 1.05;
      text-transform:uppercase;
      transform: translateY(10px);
      opacity:0;
      transition: transform .7s var(--ease), opacity .7s var(--ease);
    }
    .word.reveal{transform: translateY(0); opacity:1}

    .lede{
      margin: 14px auto 0;
      max-width: 72ch;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.75;
      transform: translateY(10px);
      opacity:0;
      transition: transform .7s var(--ease), opacity .7s var(--ease);
    }
    .lede.reveal{transform: translateY(0); opacity:1}

    .actions{
      margin-top: 18px;
      display:flex;
      justify-content:center;
      flex-wrap:wrap;
      gap:10px;
      transform: translateY(10px);
      opacity:0;
      transition: transform .7s var(--ease), opacity .7s var(--ease);
      position:relative;
      z-index:40;
    }
    .actions.reveal{transform: translateY(0); opacity:1}

    /* Buttons: homepage-style hover */
    .btn{
      display:inline-flex;
      align-items:center;
      gap:10px;
      padding:11px 14px;
      border-radius:0;
      border:var(--bw) solid #fff;
      background:#fff;
      color:#000;
      font-weight:900;
      font-size:13px;
      cursor:pointer;
      text-transform:uppercase;
      transition: transform .18s var(--ease), opacity .18s var(--ease), border-color .18s var(--ease);
      will-change: transform;
    }
    .btn.secondary{
      background:transparent;
      color:#fff;
      border-color:var(--line2);
    }
    .btn[disabled]{
      cursor:not-allowed;
      opacity:.65;
      transform:none;
    }
    .btn:hover{transform:translateY(-1px); opacity:1;}
    .btn.secondary:hover{border-color:#fff}
    .btn:active{transform:translateY(0px); opacity:.92;}

    .downloadNote{
      margin: 14px 0 0;
      text-align:center;
      color:var(--muted);
      font-size:12px;
      transform: translateY(10px);
      opacity:0;
      transition: transform .7s var(--ease), opacity .7s var(--ease);
    }
    .downloadNote.reveal{transform: translateY(0); opacity:1}
    .downloadNote a{
      color:inherit;
      border-bottom:var(--bw) solid transparent;
    }
    .downloadNote a:hover{
      color:#fff;
      border-color:rgba(255,255,255,.35);
    }

    .downloadWrap{
      position:relative;
      display:flex;
      align-items:center;
      flex-wrap:wrap;
    }
    .dropdown{
      position:relative;
      display:inline-flex;
      z-index:45;
    }
    .dropdown .caret{
      font-size:11px;
      letter-spacing:0.04em;
      margin-left:4px;
      display:inline-block;
      transition: transform .18s ease-out;
    }
    .dropdown.open .caret{
      transform: rotate(-90deg);
    }
    .menu{
      position:absolute;
      top:100%;
      left:0;
      z-index:50;
      min-width:220px;
      border:var(--bw) solid var(--line2);
      background:#000;
      box-shadow:0 12px 0 #000;
      padding:4px;
      display:grid;
      gap:4px;
    }
    .menu[hidden]{display:none;}
    .menu button{
      width:100%;
      text-align:left;
      padding:10px 12px;
      border:var(--bw) solid var(--line);
      background:rgba(255,255,255,.04);
      color:#fff;
      font-weight:900;
      font-size:12px;
      letter-spacing:0.02em;
      text-transform:uppercase;
      cursor:pointer;
      border-radius:0;
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:8px;
    }
    .menu button:hover{border-color:#fff; background:rgba(255,255,255,.07);}
    .menu button:active{opacity:.9;}
  
    .menu button{
      font-family:"Minecrafter","Minecraft",monospace;
    }
    .menu button span:last-child{
      font-family:"Minecraft", ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
    }

    .canvas{
      width: min(980px, 100%);
      margin: 28px auto 0;
      border:var(--bw) solid var(--line);
      border-radius:0;
      background: rgba(0,0,0,.35);
      padding: 18px;
      position:relative;
      overflow:hidden;
      transform: translateY(10px);
      opacity:0;
      transition: transform .7s var(--ease), opacity .7s var(--ease);
    }
    .canvas.reveal{transform: translateY(0); opacity:1}

    .canvasTop{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom:var(--bw) solid var(--line);
      padding-bottom: 12px;
      margin-bottom: 14px;
      background: transparent;
    }
    .canvasTop .meta{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      color:var(--muted2);
      font-size:12px;
      text-transform:uppercase;
    }
    .badge{
      padding:6px 10px;
      border:var(--bw) solid var(--line);
      border-radius:0;
      color:var(--muted);
      font-size:11px;
      background: rgba(0,0,0,.40);
      text-transform:uppercase;
    }

    .nodes{
      position:relative;
      height: 240px;
      border:var(--bw) solid var(--line);
      border-radius:0;
      overflow:hidden;
      background: rgba(0,0,0,.22);
    }

    svg.wires{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      pointer-events:none;
      z-index: 0;
    }

    .node{
      position:absolute;
      z-index: 1;
      --accent: #ffffff;
      border:var(--bw) solid rgba(255,255,255,.18);
      border-radius:0;
      padding: 12px 14px 12px 16px;
      background: rgba(0,0,0,.78);
      display:flex;
      align-items:center;
      gap:10px;
      cursor:grab;
      user-select:none;
      transition: border-color .18s var(--ease), transform .18s var(--ease);
      overflow:hidden;
      text-transform:uppercase;
    }
    .node::before{
      content:"";
      position:absolute;
      left:0; top:0; bottom:0;
      width: 6px;
      background: var(--accent);
      opacity:.95;
    }
    .node:active{cursor:grabbing}
    .node:hover{border-color: rgba(255,255,255,.45); transform: translateY(-1px);}

    .port{
      width: 10px;
      height: 10px;
      border-radius: 0;
      border:var(--bw) solid rgba(255,255,255,.55);
      background: var(--accent);
      opacity:1;
      flex: 0 0 auto;
    }
    .node .name{font-weight:900}
    .node .hint{color:var(--muted2); font-size:11px; margin-left:6px; text-transform:none; font-family:"Minecraft",monospace;}

    .node[data-id="start"]{ --accent: #7CFFCB; }
    .node[data-id="mine"] { --accent: #58A6FF; }
    .node[data-id="craft"]{ --accent: #FFB86B; }
    .node[data-id="place"]{ --accent: #FF5DA2; }

    .info{
      margin: 20px auto 0;
      width: min(980px, 100%);
      padding: 0 18px;
      display:grid;
      grid-template-columns: 1.15fr .85fr;
      gap: 18px;
      background: transparent;
    }

    .panel{
      border:var(--bw) solid var(--line);
      border-radius:0;
      padding: 18px;
      background: rgba(0,0,0,.35);
    }

    .panel h2{margin:0; font-size:14px; text-transform:uppercase; color:var(--muted);}
    .panel p{margin: 10px 0 0; color: var(--muted); line-height: 1.75; font-size: 14px;}

    .list{margin: 12px 0 0; padding:0; list-style:none; display:grid; gap:10px;}
    .li{border-top: var(--bw) solid rgba(255,255,255,.10); padding-top: 10px; color: var(--muted); font-size: 14px; line-height: 1.65;}
    .li b{color:#fff}

    .kv{margin-top: 12px; display:grid; gap:10px;}
    .row{
      display:flex;
      justify-content:space-between;
      gap:10px;
      border:var(--bw) solid var(--line);
      border-radius:0;
      padding: 10px 12px;
      color: var(--muted);
      font-size: 13px;
      background: rgba(0,0,0,.40);
      text-transform:uppercase;
    }
    .row span:last-child{color:#fff; font-weight:900}

    .panelVideo{
      margin-top: 14px;
      border:var(--bw) solid var(--line);
      border-radius:0;
      overflow:hidden;
      background: rgba(0,0,0,.40);
    }
    .panelVideoHead{
      padding:10px 12px;
      border-bottom:var(--bw) solid var(--line);
      color:var(--muted);
      font-size:12px;
      text-transform:uppercase;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      background: rgba(0,0,0,.30);
    }
    .panelVideoHead b{color:#fff; font-weight:900; text-transform:uppercase; font-size:13px;}
    .panelVideoFrame{position:relative; width:100%; aspect-ratio:16/9; background: #000;}
    .panelVideoFrame iframe{position:absolute; inset:0; width:100%; height:100%; border:0;}

    footer{
      margin: 14px auto 0;
      max-width: 980px;
      border-top: var(--bw) solid var(--line);
      padding: 10px 18px;
      background: transparent;
      color: var(--muted2);
      font-size: 12px;
      text-transform: uppercase;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      flex-wrap:wrap;
      line-height: 1.2;
    }
    footer a{color:var(--muted); border-bottom:var(--bw) solid transparent;}
    footer a:hover{color:#fff; border-color:rgba(255,255,255,.35)}

    @media (max-width: 900px){
      .info{grid-template-columns: 1fr;}
      .nodes{height: 300px;}
      .logo-img{width: clamp(150px, 44vw, 200px);}
      .word{font-size: clamp(18px, 4.3vw, 34px);}
    }

    @media (prefers-reduced-motion: reduce){
      .logo-img,.word,.lede,.actions,.downloadNote,.canvas{transition:none}
      .btn,.node{transition:none}
    }
  </style>
</head>
<body>
  <div class="bg" aria-hidden="true"></div>
  <div class="dots" aria-hidden="true"></div>

  <header>
    <div class="wrap nav">
      <a class="brand" href="/" aria-label="soymods home">soymods</a>
      <div aria-hidden="true"></div>
    </div>
  </header>

  <main>
    <section class="hero">
      <div class="heroInner">
        <img id="logo" src="logo.png" alt="Pathmind logo" class="logo-img">
        <h1 class="word" id="w">Pathmind</h1>

        <p class="lede" id="l">
          Pathmind provides a modular, node-driven system for scripting in-game actions and crafting automation sequences.
        </p>

        <div class="actions" id="a">
          <div class="downloadWrap">
            <div class="dropdown">
              <button id="downloadBtn" class="btn" disabled aria-expanded="false" aria-haspopup="true">Loading… <span class="caret">▼</span></button>
              <div id="downloadMenu" class="menu" hidden></div>
            </div>
          </div>
          <a class="btn secondary" href="https://discord.gg/7nGRX2d8a6" target="_blank" rel="noreferrer">Discord ↗</a>
          <a class="btn secondary" href="https://github.com/soymods/pathmind/releases" target="_blank" rel="noreferrer">All releases ↗</a>
        </div>
        <p class="downloadNote" id="dl-note">
          <a href="https://github.com/cabaletta/baritone/releases" target="_blank" rel="noreferrer">Download Baritone API</a>
        </p>

        <div class="canvas" id="c" aria-label="visual motif">
          <div class="canvasTop">
            <div class="meta">
              <span class="badge">Minecraft 1.21.x</span>
              <span class="badge">Fabric</span>
              <span class="badge">Client-side</span>
            </div>
            <span class="badge">by <span style="color:#fff; font-weight:800;">ryduzz</span></span>
          </div>

          <div class="nodes" id="nodes">
            <svg class="wires" id="wires" viewBox="0 0 1000 300" preserveAspectRatio="none" aria-hidden="true"></svg>

            <div class="node" data-id="start" style="left: 46px; top: 76px;">
              <span class="port" aria-hidden="true"></span>
              <span class="name">Start</span>
              <span class="hint">workflow</span>
            </div>
            <div class="node" data-id="mine" style="left: 330px; top: 44px;">
              <span class="port" aria-hidden="true"></span>
              <span class="name">Mine</span>
              <span class="hint">inputs</span>
            </div>
            <div class="node" data-id="craft" style="left: 600px; top: 112px;">
              <span class="port" aria-hidden="true"></span>
              <span class="name">Craft</span>
              <span class="hint">steps</span>
            </div>
            <div class="node" data-id="place" style="left: 812px; top: 64px;">
              <span class="port" aria-hidden="true"></span>
              <span class="name">Place</span>
              <span class="hint">output</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="info" aria-label="details">
      <div class="panel">
        <h2>What it is</h2>
        <p>
          Pathmind turns automation into a visual language: build workflows by connecting nodes, tune parameters, then execute sequences in-game.
          It’s designed to stay understandable even as graphs grow.
        </p>

        <ul class="list">
          <li class="li"><b>Node workflows</b> — connect actions into readable pipelines.</li>
          <li class="li"><b>Fast UI</b> — drag, connect, pan/zoom, iterate.</li>
          <li class="li"><b>Practical automation</b> — craft, place, mine, and more through a unified graph.</li>
        </ul>

        <div class="panelVideo" aria-label="What it is video">
          <div class="panelVideoHead">
            <b>Overview</b>
            <span>video</span>
          </div>
          <div class="panelVideoFrame">
            <iframe
              src="https://www.youtube.com/embed/9MJRZGiwqbE"
              title="Pathmind video"
              loading="lazy"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen>
            </iframe>
          </div>
        </div>
      </div>

      <div class="panel">
        <h2>Info</h2>
        <div class="kv">
          <div class="row"><span>Platform</span><span>Fabric</span></div>
          <div class="row"><span>Minecraft</span><span>1.21.x</span></div>
          <div class="row"><span>Environment</span><span>Client-side</span></div>
          <div class="row"><span>Downloads</span><span>GitHub Releases</span></div>
          <div class="row"><span>Support</span><span>Discord</span></div>
        </div>
        <p style="margin-top:12px; color:var(--muted2);">
          Please use responsibly and follow server rules. You are responsible for how you use automation.
        </p>

        <div class="panelVideo" aria-label="Info video">
          <div class="panelVideoHead">
            <b>Demo</b>
            <span>video</span>
          </div>
          <div class="panelVideoFrame">
            <iframe
              src="https://www.youtube.com/embed/EBJEVciVAFU"
              title="Pathmind video 2"
              loading="lazy"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen>
            </iframe>
          </div>
        </div>
      </div>
    </section>

    <footer>
      <div>© <span id="year"></span> soymods — Pathmind by ryduzz.</div>
      <div style="display:flex; gap:14px; flex-wrap:wrap;">
        <a href="/">soymods</a>
      </div>
    </footer>
  </main>

  <script>
    const reveal = () => {
      const logo = document.getElementById('logo');
      const w = document.getElementById('w');
      const l = document.getElementById('l');
      const a = document.getElementById('a');
      const dn = document.getElementById('dl-note');
      const c = document.getElementById('c');
      requestAnimationFrame(() => {
        if (logo) logo.classList.add('reveal');
        setTimeout(() => w.classList.add('reveal'), 80);
        setTimeout(() => l.classList.add('reveal'), 150);
        setTimeout(() => a.classList.add('reveal'), 230);
        setTimeout(() => dn?.classList.add('reveal'), 270);
        setTimeout(() => c.classList.add('reveal'), 310);
      });
    };

    const initGraph = () => {
      const container = document.getElementById('nodes');
      const svg = document.getElementById('wires');
      if (!container || !svg) return;

      const nodes = Array.from(container.querySelectorAll('.node'));
      const getRect = () => container.getBoundingClientRect();

      const centerOf = (el) => {
        const r = el.getBoundingClientRect();
        const cr = getRect();
        return { x: (r.left - cr.left) + r.width / 2, y: (r.top - cr.top) + r.height / 2 };
      };

      const setSvgView = () => {
        const r = getRect();
        svg.setAttribute('viewBox', `0 0 ${Math.max(1, r.width)} ${Math.max(1, r.height)}`);
      };

      const clampInitialPositions = () => {
        const bounds = getRect();
        nodes.forEach(node => {
          const w = node.offsetWidth;
          const h = node.offsetHeight;
          let left = parseFloat(node.style.left || '0');
          let top  = parseFloat(node.style.top  || '0');
          left = Math.max(8, Math.min(left, bounds.width  - w - 8));
          top  = Math.max(8, Math.min(top,  bounds.height - h - 8));
          node.style.left = left + 'px';
          node.style.top  = top  + 'px';
        });
      };

      const layoutNodes = () => {
        const bounds = getRect();
        if (!bounds.width) return;
        const ordered = nodes.slice();
        const widths = ordered.map(n => n.offsetWidth);
        const totalW = widths.reduce((a,b) => a + b, 0);
        const padding = 8;
        const usable = Math.max(0, bounds.width - padding * 2);
        const gap = (usable > totalW && ordered.length > 1)
          ? (usable - totalW) / (ordered.length - 1)
          : 10;
        let x = padding;
        ordered.forEach((node, i) => {
          node.style.left = x + 'px';
          x += widths[i] + gap;
        });
      };

      const draw = () => {
        setSvgView();
        const pairs = [['start','mine'],['mine','craft'],['craft','place']];
        const byId = Object.fromEntries(nodes.map(n => [n.dataset.id, n]));
        svg.innerHTML = '';
        pairs.forEach(([a,b]) => {
          const na = byId[a], nb = byId[b];
          if (!na || !nb) return;
          const pa = centerOf(na), pb = centerOf(nb);
          const dx = Math.max(40, Math.abs(pb.x - pa.x) * 0.45);
          const c1x = pa.x + dx, c2x = pb.x - dx;

          const glow = document.createElementNS('http://www.w3.org/2000/svg','path');
          glow.setAttribute('d', `M ${pa.x} ${pa.y} C ${c1x} ${pa.y}, ${c2x} ${pb.y}, ${pb.x} ${pb.y}`);
          glow.setAttribute('fill','none');
          glow.setAttribute('stroke','rgba(255,255,255,.10)');
          glow.setAttribute('stroke-width','6');
          glow.setAttribute('stroke-linecap','round');

          const path = document.createElementNS('http://www.w3.org/2000/svg','path');
          path.setAttribute('d', glow.getAttribute('d'));
          path.setAttribute('fill','none');
          path.setAttribute('stroke','rgba(255,255,255,.45)');
          path.setAttribute('stroke-width','1.5');
          path.setAttribute('stroke-linecap','round');

          svg.appendChild(glow);
          svg.appendChild(path);
        });
      };

      let active = null;
      let userMoved = false;
      let startX = 0, startY = 0;
      let nodeStartLeft = 0, nodeStartTop = 0;

      const onDown = (e, node) => {
        userMoved = true;
        active = node;
        const st = window.getComputedStyle(node);
        nodeStartLeft = parseFloat(st.left || '0');
        nodeStartTop = parseFloat(st.top || '0');
        startX = e.clientX;
        startY = e.clientY;
        node.setPointerCapture?.(e.pointerId);
      };

      const onMove = (e) => {
        if (!active) return;
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const bounds = getRect();
        const w = active.offsetWidth;
        const h = active.offsetHeight;

        let left = nodeStartLeft + dx;
        let top = nodeStartTop + dy;

        left = Math.max(8, Math.min(left, bounds.width - w - 8));
        top  = Math.max(8, Math.min(top,  bounds.height - h - 8));

        active.style.left = left + 'px';
        active.style.top  = top + 'px';
        draw();
      };

      const onUp = () => { active = null; };

      nodes.forEach(node => node.addEventListener('pointerdown', (e) => onDown(e, node)));
      window.addEventListener('pointermove', onMove, { passive: true });
      window.addEventListener('pointerup', onUp);

      window.addEventListener('resize', () => {
        if (!userMoved) layoutNodes();
        clampInitialPositions();
        draw();
      });

      requestAnimationFrame(() => {
        layoutNodes();
        clampInitialPositions();
        draw();
      });
    };

    const initDownloadUI = () => {
      const downloadBtn = document.getElementById('downloadBtn');
      const downloadMenu = document.getElementById('downloadMenu');
      const releasesPage = 'https://github.com/soymods/pathmind/releases';
      const apiUrl = 'https://api.github.com/repos/soymods/pathmind/releases?per_page=30';
      if (!downloadBtn || !downloadMenu) return;

      let assets = [];

      const setButtonLabel = (label) => {
        downloadBtn.innerHTML = `${label} <span class="caret">▼</span>`;
      };

      const parseVersionParts = (v) => v.split('.').map(n => parseInt(n, 10) || 0);
      const sortVersionsDesc = (a, b) => {
        const pa = parseVersionParts(a);
        const pb = parseVersionParts(b);
        const len = Math.max(pa.length, pb.length);
        for (let i = 0; i < len; i++) {
          const av = pa[i] ?? 0;
          const bv = pb[i] ?? 0;
          if (av !== bv) return bv - av;
        }
        return b.localeCompare(a);
      };

      const closeMenu = () => {
        downloadMenu.hidden = true;
        downloadBtn.setAttribute('aria-expanded', 'false');
        downloadBtn.closest('.dropdown')?.classList.remove('open');
      };

      const toggleMenu = () => {
        if (assets.length === 0) return;
        const isOpen = !downloadMenu.hidden;
        if (isOpen) {
          closeMenu();
        } else {
          downloadMenu.hidden = false;
          downloadBtn.setAttribute('aria-expanded', 'true');
          downloadBtn.closest('.dropdown')?.classList.add('open');
        }
      };

      const setLoading = (isLoading) => {
        downloadBtn.disabled = isLoading;
        setButtonLabel(isLoading ? 'Loading…' : 'Download');
        closeMenu();
      };

      const setFallback = () => {
        assets = [];
        closeMenu();
        downloadBtn.disabled = false;
        setButtonLabel('Download');
        downloadBtn.onclick = () => { window.location.href = releasesPage; };
        downloadMenu.innerHTML = '';
      };

      const buildMenu = () => {
        downloadMenu.innerHTML = '';
        assets.forEach(item => {
          const btn = document.createElement('button');
          btn.type = 'button';
          const title = document.createElement('span');
          title.textContent = `${item.mc}`;
          const file = document.createElement('span');
          file.style.color = 'var(--muted)';
          file.style.fontSize = '11px';
          file.textContent = item.name;
          btn.appendChild(title);
          btn.appendChild(file);
          btn.addEventListener('click', () => {
            window.location.href = item.url;
            closeMenu();
          });
          downloadMenu.appendChild(btn);
        });
      };

      const setSuccessHandlers = () => {
        downloadBtn.disabled = false;
        setButtonLabel('Download');
        downloadBtn.onclick = toggleMenu;
        document.addEventListener('click', (e) => {
          if (!downloadMenu.contains(e.target) && !downloadBtn.contains(e.target)) closeMenu();
        });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeMenu(); });
      };

      const fetchReleases = async () => {
        setLoading(true);
        try {
          const res = await fetch(apiUrl);
          if (!res.ok) throw new Error('API error');
          const data = await res.json();
          const latest = (data || []).find(r => !r.draft);
          if (!latest) throw new Error('No release');

          const assetsByMc = {};
          (latest.assets || []).forEach(asset => {
            const match = asset.name?.match(/^pathmind-([^+]+)\+mc([0-9][0-9.]*)\.jar$/i);
            if (!match) return;
            const mcVersion = match[2];
            assetsByMc[mcVersion] = asset;
          });

          const mcVersions = Object.keys(assetsByMc).sort(sortVersionsDesc);
          if (!mcVersions.length) throw new Error('No assets');

          assets = mcVersions.map(mc => ({
            mc,
            url: assetsByMc[mc]?.browser_download_url || releasesPage,
            name: assetsByMc[mc]?.name || `pathmind+mc${mc}`
          }));

          buildMenu();
          setSuccessHandlers();
        } catch (err) {
          console.error('Failed to load releases', err);
          setFallback();
        } finally {
          setLoading(false);
        }
      };

      fetchReleases();
    };

    document.addEventListener('DOMContentLoaded', () => {
      const yearEl = document.getElementById('year');
      if (yearEl) yearEl.textContent = new Date().getFullYear();
      reveal();
      initGraph();
      initDownloadUI();
    });
  </script>
</body>
</html>
